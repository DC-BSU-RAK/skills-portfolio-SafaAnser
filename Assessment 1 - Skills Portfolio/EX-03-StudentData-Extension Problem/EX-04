from tkinter import * #importing tkinter 
from tkinter import ttk #importing ttk for themed 
from PIL import ImageTk,Image  #importing PIL for importing image
from tkinter import messagebox #importinh messagebox for showing info and errors

window=Tk() #creates the main application window
window.title('Student Management - Extension Problem') #sets the title of the window
window.state('zoomed') #keeps window in maximized state
window.resizable(FALSE, FALSE) #disables window resizing

bg = Image.open('Assessment 1 - Skills Portfolio/EX-03-StudentData-Extension Problem/resources-4/bg.png') #opening background image
bg_rs = bg.resize((1535,840))#resizing background image to fit the window
bg_1 = ImageTk.PhotoImage(bg_rs) #converts image for tkinter
bg_l = Label(window, image=bg_1)  #creating label to display background image
bg_l.place(x=0,y=0) #placing background label
bg_l.lower() #sends label to back layer

heading=Frame(window, width=650, height=70, bg='#d9d9d9') #creates heading frame
heading.place(x=650,y=50) #positioning heading frame

title=Label(heading, text='Student Management', font=('Courier New',45,'bold'), bg='#d9d9d9')#creates title label
title.place(relx=0.5,rely=0.5, anchor=CENTER)#centers text in heading


contents = Frame(window, width=1202, height=632, bg='#d9d9d9')#main content frame
contents.place(x=330, y=200)


with open('Assessment 1 - Skills Portfolio/A1 - Resources/studentmarks.txt') as file_handler: #opens student marks file
    lines = file_handler.readlines()[1:]  #open file and skip first line (student count)


def asc():
        global lines #use global list
        lines=sorted(lines, key=lambda x: x.split(',')[1].strip()) #sort by name (A–Z)
        all_student()#refresh table
    
def dsc():
        global lines #use global list
        lines = sorted(lines, key=lambda x: x.split(',')[1].strip(), reverse=True)#sort by name (Z–A)
        all_student()#refresh table


def delete_fr(): #defines function to clear content frame
    for frame in contents.winfo_children(): #loops through all widgets
        frame.destroy() #removes each widget



def create_treeview(frame):#function to create a treeview

    cols = ('No.','Student ID','Name', 'Total coursework mark', 'Exam mark','Total percentage','Student grade') #column names


    tree = ttk.Treeview(frame, columns=cols, show="headings", height=20) #creates treeview widget


    style = ttk.Style() #creates style object
    style.configure('Treeview.Heading', font=(' Courier New', 11, 'bold'))#sets heading style    
    style.configure('Treeview', font=('Courier New', 12),rowheight=25 )#sets row text style


    for col in cols:#loops through column names
        tree.heading(col, text=col) #sets each heading
        tree.column(col, width=168, anchor=CENTER) #sets width and center alignment


    scrollbar = Scrollbar(tree, orient=VERTICAL, command=tree.yview)#creates vertical scrollbar
    tree.configure(yscroll=scrollbar.set) #connects scrollbar
    scrollbar.place(relx=1.0, rely=0.5, anchor=E, relheight=1.0)#places scrollbar inside tree

    return tree #returns created treeview



def all_student(): #function to show all student data
    delete_fr() #clears previous content
    fr_1 = Frame(contents, width=1202, height=632, bg='#d9d9d9')#creates frame for content
    fr_1.place(x=0, y=0)

    tree = create_treeview(fr_1) #creates treeview
    tree.place(relx=0.5, rely=0, anchor=N)

    num_stud = 1 #counter for students
    total_percent_sum = 0 #sum of percentages


    for line in lines: #loops through each line of file
        parts = line.strip().split(',') #splits line into list
        if len(parts) == 6: #checks valid format
            stud_id, name, c1, c2, c3, exam = parts[0], parts[1], int(parts[2]), int(parts[3]), int(parts[4]), int(parts[5]) #assigns values
            course_total = c1 + c2 + c3 #calculates coursework total
            total_percentage = round(((course_total + exam) / 160) * 100, 2) #calculates total percentage
            grade = 'A' if total_percentage >= 70 else 'B' if total_percentage >= 60 else 'C' if total_percentage >= 50 else 'D' if total_percentage >= 40 else 'F' #assigns grade
            tree.insert('', 'end', values=(num_stud, stud_id, name, course_total, exam, total_percentage, grade))#inserts row
            num_stud += 1 #increments student count
            total_percent_sum += total_percentage #adds percentage for average

    Label(fr_1, text=f'Number of students: {num_stud-1}', bg='#d9d9d9', font=('Courier New',20,'bold')).place(x=10,y=540) #displays total students

    avg_percent = round(total_percent_sum / (num_stud-1), 2) #calculates average percentage
    Label(fr_1, text=f'Average percentage: {avg_percent}', bg='#d9d9d9', font=('Courier New',20,'bold')).place(x=10,y=590) #displays average percentage

    
    sort = Menubutton(fr_1, text='Sort by Name',bg='#141223',fg='#d9d9d9', font=('Courier New', 16, 'bold'), relief=RAISED )#creates sort dropdown
    sort_menu = Menu(sort, tearoff=0)#creates menu for options
    sort.config(menu=sort_menu)#connects menu to button
    sort_menu.add_command(label='Ascending', command=asc)#adds ascending option
    sort_menu.add_command(label='Descending', command=dsc)#adds descending option
    sort.place(x=1020,y=530) #places dropdown on frame



def individual_stud(): #function to search student by id
    delete_fr()
    fr_2 = Frame(contents, width=1202, height=632, bg='#d9d9d9') #creates new frame
    fr_2.place(x=0, y=0) #places frame

    tree = create_treeview(fr_2)#creates treeview
    tree.place(relx=0.5, rely=0, anchor=N)

    style = ttk.Style()
    style.configure('Treeview', font=('Courier New', 12),rowheight=20 )

    ask_stud=Label(fr_2, text='Enter Student ID: ',font=('Courier New', 18, 'bold'), bg='#d9d9d9') #label asking for ID
    ask_stud.place(x=400,y=460)

    entry=Entry(fr_2, font=('Courier New', 18)) #creates entry box
    entry.place(x=650, y=460) 

    not_found = Label(fr_2, text="", font=('Courier New', 18, 'bold'), fg="red", bg='#d9d9d9') #label for error message
    not_found.place(x=510, y=430)


    def search_student(): #nested function to search
        search = entry.get().strip() #gets entered id
        tree.delete(*tree.get_children()) #clears old results

        found = False  #indicates if the search result exists or not

        for line in lines: #loops through students
            parts = line.strip().split(',') #splits data
            if len(parts) == 6 and parts[0] == search: #checks for matching id
                stud_id, name, c1, c2, c3, exam = parts[0], parts[1], int(parts[2]), int(parts[3]), int(parts[4]), int(parts[5])  #extracts data
                course_total = c1 + c2 + c3#course total
                total_percentage = round(((course_total + exam) / 160) * 100, 2)#calculating percentage
                grade = 'A' if total_percentage >= 70 else 'B' if total_percentage >= 60 else 'C' if total_percentage >= 50 else 'D' if total_percentage >= 40 else 'F' #grade

                tree.insert('', 'end', values=(1, stud_id, name, course_total, exam, total_percentage, grade))  #inserts result
                found = True #indicates the search result exists
                break #stops loop

        if found:
            not_found.config(text='')#clears error text
        else:
            not_found.config(text='Student not found!')#shows error message    


    btn = Button(fr_2, text='Search', 
           font=('Courier New', 16, 'bold'),
           bg='#141223', 
           fg='#d9d9d9',
           command=search_student) #search button
    btn.place(x=600, y=500)#places button



def highest(): #function to get highest scoring student
    delete_fr()
    fr_3 = Frame(contents, width=1202, height=632, bg='#d9d9d9')
    fr_3.place(x=0, y=0)

    tree = create_treeview(fr_3)
    tree.place(relx=0.5, rely=0, anchor=N)

    high_stud= None #stores highest student
    high_percent = 0 #sets minimum possible percentage

    for line in lines: #loops through data
        parts = line.strip().split(',') #splits line
        if len(parts) == 6: #checks valid
            stud_id, name, c1, c2, c3, exam = parts[0], parts[1], int(parts[2]), int(parts[3]), int(parts[4]), int(parts[5]) #assigns data
            course_total = c1 + c2 + c3#course total
            total_percentage = round(((course_total + exam) / 160) * 100, 2) #calculates percentage

            if total_percentage > high_percent:#checks new highest
                high_percent = total_percentage #updates highest percentage
                high_stud = (stud_id, name, course_total, exam, total_percentage) #stores highest student


    if high_stud: #checks if student found
        stud_id, name, course_total, exam, total_percentage = high_stud #unpacks tuple
        grade = 'A' if total_percentage >= 70 else 'B' if total_percentage >= 60 else 'C' if total_percentage >= 50 else 'D' if total_percentage >= 40 else 'F' #gets grade
        tree.insert('', 'end', values=(1, stud_id, name, course_total, exam, total_percentage, grade)) #inserts highest student



def lowest(): #function to get lowest performer
    delete_fr()
    fr_4 = Frame(contents, width=1202, height=632, bg='#d9d9d9')
    fr_4.place(x=0, y=0)

    tree = create_treeview(fr_4)
    tree.place(relx=0.5, rely=0, anchor=N)

    low_stud = None#stores lowest student
    low_percent = 161 #sets above max possible percentage

    for line in lines:
        parts = line.strip().split(',')
        if len(parts) == 6:
            stud_id, name, c1, c2, c3, exam = parts[0], parts[1], int(parts[2]), int(parts[3]), int(parts[4]), int(parts[5])
            course_total = c1 + c2 + c3
            total_percentage = round(((course_total + exam) / 160) * 100, 2)

            if total_percentage < low_percent: #checks new lowest
                low_percent = total_percentage #updates lowest value
                low_stud = (stud_id, name, course_total, exam, total_percentage)#stores student

    if low_stud:
        stud_id, name, course_total, exam, total_percentage = low_stud
        grade = 'A' if total_percentage >= 70 else 'B' if total_percentage >= 60 else 'C' if total_percentage >= 50 else 'D' if total_percentage >= 40 else 'F'
        tree.insert('', 'end', values=(1, stud_id, name, course_total, exam, total_percentage, grade))



def add_stud(): # defines the function to add a student
    delete_fr() 
    fr_5 = Frame(contents, width=1202, height=632, bg='#d9d9d9')
    fr_5.place(x=0, y=0)

    stud_id_l= Label(fr_5,text='Student ID: ', #creates new frame for add student page
                     font=('Courier New', 16, 'bold'), 
                     fg='#141223',
                     bg='#d9d9d9')
    stud_id_l.place(x=100,y=50)
    stud_id=Entry(fr_5, #creates entry for student id
                  font=('Courier New', 16, 'bold'),
                  bg='#213543',
                  fg='#d9d9d9')
    stud_id.place(x=250,y=50)

    name_l= Label(fr_5,text='Student Name: ', #creates label for name
                       font=('Courier New', 16, 'bold'), 
                       fg='#141223',
                       bg='#d9d9d9')
    name_l.place(x=100,y=100)
    name=Entry(fr_5, #creates entry for name
                    font=('Courier New', 16, 'bold'), 
                    bg="#213543",
                    fg='#d9d9d9')
    name.place(x=275,y=100)

    cr1_l= Label(fr_5,text='Course 1 Mark: ', #creates label for course1
                 font=('Courier New', 16, 'bold'), 
                 fg='#141223',
                 bg='#d9d9d9')
    cr1_l.place(x=100,y=150)
    cr1=Entry(fr_5, #creates entry for course1
              font=('Courier New', 16, 'bold'), 
              bg='#213543',
              fg='#d9d9d9')
    cr1.place(x=285,y=150)

    cr2_l= Label(fr_5,text='Course 2 Mark: ', #creates label for course2
                   font=('Courier New', 16, 'bold'), 
                   fg='#141223',
                   bg='#d9d9d9')
    cr2_l.place(x=100,y=200)
    cr2=Entry(fr_5, #creates entry for course2
              font=('Courier New', 16, 'bold'), 
              bg='#213543',
              fg='#d9d9d9')
    cr2.place(x=285,y=200)

    cr3_l= Label(fr_5,text='Course 3 Mark: ',#creates label for course3
                   font=('Courier New', 16, 'bold'), 
                   fg='#141223',
                   bg='#d9d9d9')
    cr3_l.place(x=100,y=250)
    cr3=Entry(fr_5,#creates entry for course3
              font=('Courier New', 16, 'bold'), 
              bg='#213543',
              fg='#d9d9d9')
    cr3.place(x=285,y=250)

    exam_l= Label(fr_5,text='Exam Mark: ',#creates label for exam
                   font=('Courier New', 16, 'bold'), 
                   fg='#141223',
                   bg='#d9d9d9')
    exam_l.place(x=100,y=300)
    exam=Entry(fr_5,#creates entry for exam
              font=('Courier New', 16, 'bold'), 
              bg='#213543',
              fg='#d9d9d9')
    exam.place(x=235,y=300)


    def submit(): #defines the submit function
        try:#starts error checking
            #Validate numeric fields
            int(cr1.get())
            int(cr2.get())
            int(cr3.get())
            int(exam.get())

            #Write to file
            with open('Assessment 1 - Skills Portfolio/A1 - Resources/studentmarks.txt', 'a') as file:#opens file to append
                file.write(f'\n{stud_id.get()},{name.get()},{cr1.get()},{cr2.get()},{cr3.get()},{exam.get()}')#writes student data

    
            messagebox.showinfo('Success', 'Student added successfully!')#shows success message

            #clears all entry box
            stud_id.delete(0, 'end')
            name.delete(0, 'end')
            cr1.delete(0, 'end')
            cr2.delete(0, 'end')
            cr3.delete(0, 'end')
            exam.delete(0, 'end')

        except ValueError:
            #if marks are not numbers, show error popup
            messagebox.showerror('Error', 'Course and Exam marks must be numbers!')


    Button(fr_5, text='Add Student',#creates the add button
           font=('Courier New', 16, 'bold'),
           bg='#141223', 
           fg='#d9d9d9',
           command=submit).place(x=550, y=350)
    


def delete_stud(): #defines function to delete student
    delete_fr()
    fr_6 = Frame(contents, width=1202, height=632, bg='#d9d9d9')
    fr_6.place(x=0, y=0)

    Label(fr_6, text='Enter Student ID:', font=('Courier New', 16, 'bold'), #creates label 
          fg='#141223', bg='#d9d9d9').place(x=350, y=100)

    entry = Entry(fr_6, font=('Courier New', 16, 'bold'),#creates entry for delete input
                  bg='#213543', fg='#d9d9d9')
    entry.place(x=600, y=100)

    
    def delete(): #referenced a bit from chatgpt
        stud_del = entry.get().strip()#gets id to delete
        with open('Assessment 1 - Skills Portfolio/A1 - Resources/studentmarks.txt', 'r') as file: # opens file read
            lines = file.readlines()#reads all lines

        updated_lines = []#stores kept lines
        deleted_line = None #stores deleted line

        for line in lines: #loops through lines
            parts = line.strip().split(',')#splits line
            if len(parts) == 6 and parts[0].strip() == stud_del:#checks if id matches record
                deleted_line = line #stores matched record
            else:
                updated_lines.append(line)#keeps unmatched record

        with open('Assessment 1 - Skills Portfolio/A1 - Resources/studentmarks.txt', 'w') as file:#opens file to rewrite
            file.writelines(updated_lines)#writes updated list without deleted record

        if deleted_line:#checks if deletion occurred
            messagebox.showinfo('Success', f'Student {deleted_line.strip()} deleted successfully!')#shows success message
            all_student() #refreshes student table
        else:
            messagebox.showerror('Error', f'Student ID {stud_del} not found.')#shows error message

        entry.delete(0, 'end')

    Button(fr_6, text='Delete Student', 
           font=('Courier New', 16, 'bold'),
           bg='#141223', 
           fg='#d9d9d9',
           command=delete).place(x=500, y=150)#creates delete button



def update_stud():#defines update student page
    delete_fr()
    fr_7 = Frame(contents, width=1202, height=632, bg='#d9d9d9')
    fr_7.place(x=0, y=0)

    # Student ID entry
    Label(fr_7, text='Enter Student ID:', font=('Courier New', 16, 'bold'),
          fg='#141223', bg='#d9d9d9').place(x=100, y=100)#creates label for id field
    
    studId_entry = Entry(fr_7, font=('Courier New', 16, 'bold'),
                         bg='#213543', fg='#d9d9d9')#creates entry to input student id
    studId_entry.place(x=330, y=100)

    # Combobox for field selection
    Label(fr_7, text='Select field to update:', font=('Courier New', 16, 'bold'),
          fg='#141223', bg='#d9d9d9').place(x=100, y=150)#label for field selection
    
    fields = ttk.Combobox(fr_7, font=('Courier New', 14),
                          values=['Name', 'Course1', 'Course2', 'Course3', 'Exam'])#combobox with update fields
    fields.place(x=410, y=150)

    # New value entry
    Label(fr_7, text='Enter new value:', font=('Courier New', 16, 'bold'),
          fg='#141223', bg='#d9d9d9').place(x=100, y=200)#label for new value field
    
    update_value = Entry(fr_7, font=('Courier New', 16, 'bold'),
                         bg='#213543', fg='#d9d9d9')#entry field for new data
    update_value.place(x=320, y=200)


    def submit():#defines submit function for updating
        stud_id = studId_entry.get().strip()#gets id input
        field = fields.get()#gets chosen field
        new_value = update_value.get().strip()#gets new value input

        if not stud_id or not field or not new_value:#validates required fields
            messagebox.showerror('Error', 'Please fill all fields!')#shows error popup
            return#exits function

        with open('Assessment 1 - Skills Portfolio/A1 - Resources/studentmarks.txt', 'r') as file:
            lines = file.readlines()

        updated_lines = []#creates list to store modified lines
        updated = False#tracks if update happened
        for line in lines: # referenced some from chatgpt
            parts = line.strip().split(',')
            if len(parts) == 6 and parts[0].strip() == stud_id:#checks if id matches
                field_map = {'Name': 1, 'Course1': 2, 'Course2': 3, 'Course3': 4, 'Exam': 5}#maps fields to indexes
                index = field_map[field] #gets correct index
                parts[index] = new_value  #updates selected field
                updated_line = '',''.join(parts) + '\n' #reconstructs updated record
                updated_lines.append(updated_line) #adds updated record
                updated = True #marks update true
            else:
                updated_lines.append(line) #keeps original line

        with open('Assessment 1 - Skills Portfolio/A1 - Resources/studentmarks.txt', 'w') as file: #opens file for rewriting
            file.writelines(updated_lines) #writes modified data

        if updated:#checks if update successful
            messagebox.showinfo('Success', f'{field} updated successfully for Student ID {stud_id}!') #shows success popup
            studId_entry.delete(0, 'end') #clears id entry
            update_value.delete(0, 'end')#clears new value entry
            field.set('')#clears combobox
            all_student() # refresh table
        else:
            messagebox.showerror('Error', f'Student ID {stud_id} not found.') #shows error popup

    Button(fr_7, text='Update Student',
           font=('Courier New', 16, 'bold'),
           bg='#141223', 
           fg='#d9d9d9',
           command=submit).place(x=100, y=250)#creates update button



Button(window, text='All Students Info', 
       font=('Courier New', 16, 'bold'), 
       bg='#141223',
       fg='#d9d9d9',
       activebackground='#141223',
       highlightthickness=0,
       activeforeground='#666666',
       borderwidth=1,
       relief=RIDGE,
       command=all_student).place(x=50,y=200) #button to show info of all students

Button(window, text='Search', 
       font=('Courier New', 16, 'bold'), 
       bg='#141223',
       fg='#d9d9d9',
       activebackground='#141223',
       highlightthickness=0,
       activeforeground='#666666',
       borderwidth=1,
       relief=RIDGE,
       command=individual_stud).place(x=50,y=250) #button for searching

Button(window, text='Highest Performer', 
       font=('Courier New', 16, 'bold'), 
       bg='#141223',
       fg='#d9d9d9',
       activebackground='#141223',
       highlightthickness=0,
       activeforeground='#666666',
       borderwidth=1,
       relief=RIDGE,
       command=highest).place(x=50,y=300)#button to show highest perfromer

Button(window, text='Lowest Performer', 
       font=('Courier New', 16, 'bold'), 
       bg='#141223',
       fg='#d9d9d9',
       activebackground='#141223',
       highlightthickness=0,
       activeforeground='#666666',
       borderwidth=1,
       relief=RIDGE,
       command=lowest).place(x=50,y=350) #button to show lowest performer

Button(window, text='Add Student', 
       font=('Courier New', 16, 'bold'), 
       bg='#141223',
       fg='#d9d9d9',
       activebackground='#141223',
       highlightthickness=0,
       activeforeground='#666666',
       borderwidth=1,
       relief=RIDGE,
       command=add_stud).place(x=50,y=400) #button to add student info 

Button(window, text='Delete Student', 
       font=('Courier New', 16, 'bold'), 
       bg='#141223',
       fg='#d9d9d9',
       activebackground='#141223',
       highlightthickness=0,
       activeforeground='#666666',
       borderwidth=1,
       relief=RIDGE,
       command=delete_stud).place(x=50,y=450) #button to delete student info

Button(window, text='Update Student', 
       font=('Courier New', 16, 'bold'), 
       bg='#141223',
       fg='#d9d9d9',
       activebackground='#141223',
       highlightthickness=0,
       activeforeground='#666666',
       borderwidth=1,
       relief=RIDGE,
       command=update_stud).place(x=50,y=500) #button to update student info

window.mainloop()